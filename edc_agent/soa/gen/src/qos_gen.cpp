/****************************************************************
  Generated by ChangAn Code Generator,Do Not Modify

  Generate Time: 2023-10-31 16:54:49
*****************************************************************/
#include "qos_gen.h"
#include <mutex>
#include <string.h>

typedef string topic_name;

static map<topic_name, qos_params> g_qps;

void qos_data_copy(ddsi_octetseq_t* data, const void* value, size_t sz)
{
   if (!data || !value || sz <= 0) {
        return;
    }

    void* p = malloc(sz);
    if (!p) {
        return;
    }

    if (data->value) {
        free(data->value);
    }

	data->value = (unsigned char*)p;
    memcpy(data->value, value, sz);
    data->length = (uint32_t)sz;
}

void set_qos_params() {
}

qos_params* get_qos_params(string topic_name) {
    static once_flag once;
    call_once(once, [&] {
        set_qos_params();
        });

    auto it = g_qps.find(topic_name);
    if (it == g_qps.end()) {
        return NULL;
    }

    return &it->second;
}

void release_all_qos_params() {
    for (auto it : g_qps) {
        auto p = &g_qps[it.first];

        if (p->groupdata.value && p->groupdata.length > 0) {
            free(p->groupdata.value);
            memset(&p->groupdata, 0, sizeof(ddsi_octetseq_t));
        }

        if (p->topicdata.value && p->topicdata.length > 0) {
            free(p->topicdata.value);
            memset(&p->topicdata, 0, sizeof(ddsi_octetseq_t));
        }

        if (p->userdata.value && p->userdata.length > 0) {
            free(p->userdata.value);
            memset(&p->userdata, 0, sizeof(ddsi_octetseq_t));
        }
    }
}

